<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dream.muke.mapper.CourseMapper" >
    <select id="getCourseNameAndId" resultType="Course">
		select cname,cno from course
    </select>
    
    <select id="getCourseInfo" parameterType="map" resultType="CourseBean">
        select * from (select d.*,rownum rn from (select a.cNo,cName,dName,cPic,cProfiles,ctDirname,ctName,cUpdatetime,cUpstatus,a.cStatus
		from(select dName,cNo,cName,cPic,cProfiles,ctNo,cUpdatetime,cUpstatus,c.cStatus from deeply e,course c where e.dNo=c.dNo)a,
		ctype ct where ct.ctNo=a.ctNo)d where cStatus!=0 and rownum<![CDATA[<]]>=10)b where rn<![CDATA[>]]>0
    </select>
    
    <select id="getCourseByInfo" parameterType="map" resultType="CourseBean">
        select * from (select d.*,rownum rn from (select a.cNo,ct.ctNo,cName,dName,ctDirname,ctName,cUpdatetime,cUpstatus,a.cStatus
		from(select dName,cNo,cName,ctNo,cUpdatetime,cUpstatus,c.cStatus from deeply e,course c where e.dNo=c.dNo)a,
		ctype ct where ct.ctNo=a.ctNo)d where cStatus!=0 and rownum<![CDATA[<]]>=10)b
		<where>
		    <if test="rn!=null">
		        rn<![CDATA[>]]>((${page}-1)*${rows})
		    </if>
		    <if test="cName!=null">
		        and cname like '%${cName}%'
		    </if>
		    <if test="ctNo!=0">
		        and ctNo=#{ctNo}
		    </if>
		</where>
    </select>
    
    <update id="updateCourseInfo" parameterType="map">
        update course set cName=#{cName},cUpstatus=#{cUpstatus},cStatus=#{cStatus} where cNo=#{cNo}
    </update>
    
    <!--前台部分 -->
    
    <!-- 根据课程名查找课程信息 -->
    <select id="getCourseByCname" parameterType="map" resultType="CourseBean">
        select * from (select d.*,rownum rn from (select a.cNo,ct.ctNo,cName,cPic,dName,ctDirname,ctName,cUpdatetime,cUpstatus,a.cStatus
		from(select dName,cNo,cName,cPic,ctNo,cUpdatetime,cUpstatus,c.cStatus from deeply e,course c where e.dNo=c.dNo)a,
		ctype ct where ct.ctNo=a.ctNo)d where cStatus!=0 and rownum<![CDATA[<]]>=10)b where cname like '%${cName}%'
    </select>
    
    <!-- 根据课程编号查找课程信息 -->
    <select id="showCoursesByCno" parameterType="map" resultType="CourseBean">
        select * from (select d.*,rownum rn from (select a.cNo,ct.ctNo,cName,cPic,dName,ctDirname,ctName,cUpdatetime,cUpstatus,a.cStatus
		from(select dName,cNo,cName,cPic,ctNo,cUpdatetime,cUpstatus,c.cStatus from deeply e,course c where e.dNo=c.dNo)a,
		ctype ct where ct.ctNo=a.ctNo)d where cStatus!=0 and rownum<![CDATA[<]]>=10)b where cNo=#{cNo}
    </select>
    
    <!-- 根据课程方向查找课程信息 -->
    <select id="getCourseByCdirname" parameterType="map" resultType="CourseBean">
        select * from (select d.*,rownum rn from (select a.cNo,ct.ctNo,cName,cPic,dName,ctDirname,ctName,cUpdatetime,cUpstatus,a.cStatus
		from(select dName,cNo,cName,cPic,ctNo,cUpdatetime,cUpstatus,c.cStatus from deeply e,course c where e.dNo=c.dNo)a,
		ctype ct where ct.ctNo=a.ctNo)d where cStatus!=0 and rownum<![CDATA[<]]>=10)b where ctDirname=#{ctDirname}
    </select>
    
    <!-- 根据课程类型名查找课程信息 -->
    <select id="getCourseByCtname" parameterType="map" resultType="CourseBean">
        select * from (select d.*,rownum rn from (select a.cNo,ct.ctNo,cName,cPic,dName,ctDirname,ctName,cUpdatetime,cUpstatus,a.cStatus
		from(select dName,cNo,cName,cPic,ctNo,cUpdatetime,cUpstatus,c.cStatus from deeply e,course c where e.dNo=c.dNo)a,
		ctype ct where ct.ctNo=a.ctNo)d where cStatus!=0 and rownum<![CDATA[<]]>=10)b where ctName=#{ctName}
    </select>
    
    <!-- 根据课程难易度查找课程信息 -->
     <select id="getCourseByDname" parameterType="map" resultType="CourseBean">
        select * from (select d.*,rownum rn from (select a.cNo,ct.ctNo,cName,cPic,dName,ctDirname,ctName,cUpdatetime,cUpstatus,a.cStatus
		from(select dName,cNo,cName,cPic,ctNo,cUpdatetime,cUpstatus,c.cStatus from deeply e,course c where e.dNo=c.dNo)a,
		ctype ct where ct.ctNo=a.ctNo)d where cStatus!=0 and rownum<![CDATA[<]]>=10)b where dName=#{dName}
    </select>
</mapper>